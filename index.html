<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPS - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø´Ø±Ù ÙˆØ§Ù„Ø·Ù„Ø§Ø¨</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary: #8e44ad; --bg: #f4f7fe; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { width: 90%; max-width: 400px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; }
        .btn-p { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .preview { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin: 10px auto; border: 2px solid var(--primary); display: none; }
        
        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© */
        #id-card { width: 320px; height: 190px; border: 2px solid var(--primary); border-radius: 12px; margin: 20px auto; display: none; background: white; text-align: right; }
        .c-head { background: var(--primary); color: white; padding: 5px; text-align: center; font-size: 12px; }
        .c-body { display: flex; padding: 10px; gap: 10px; }
        
        @media print { body * { visibility: hidden; } #id-card, #id-card * { visibility: visible; } #id-card { position: absolute; left: 0; top: 0; display: block !important; } }
    </style>
</head>
<body>

<div class="card" id="box">
    <div id="login-view">
        <img src="1000219663.jpg" style="width:100px;" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9131/9131529.png'">
        <h2>IPS</h2>
        <input type="text" id="l-id" placeholder="Ø§Ù„Ù€ ID">
        <input type="password" id="l-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-p" onclick="doLogin()">Ø¯Ø®ÙˆÙ„</button>
        <p onclick="view('reg')" style="color:var(--primary); cursor:pointer;">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</p>
    </div>

    <div id="reg-view" style="display:none;">
        <h3>ØªØ³Ø¬ÙŠÙ„ ÙÙŠ IPS</h3>
        <input type="file" accept="image/*" onchange="upImg(this)">
        <img id="img-p" class="preview">
        <input type="text" id="r-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
        <input type="number" id="r-id" placeholder="ID (04... Ù„Ù„Ù…Ø´Ø±Ù)">
        <input type="password" id="r-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-p" id="save-btn" onclick="doSave()">Ø­ÙØ¸ ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <button onclick="view('login')" style="border:none; background:none; color:gray;">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="profile-view" style="display:none;">
        <img id="u-img" class="preview" style="display:block;">
        <h3 id="u-name">---</h3>
        <p id="u-role">---</p>
        <button class="btn-p" style="background:#2ecc71" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
        <div id="admin-list" style="display:none; text-align:right; font-size:12px; border-top:1px solid #eee; margin-top:10px;"></div>
        <button onclick="location.reload()" style="margin-top:10px;">Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<div id="id-card">
    <div class="c-head">IPS - Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ø¨Ù† Ø®Ù„Ø¯ÙˆÙ†</div>
    <div class="c-body">
        <img id="c-img" src="" style="width:80px; height:100px; border-radius:5px; object-fit:cover;">
        <div style="font-size:11px;">
            <b>Ø§Ù„Ø§Ø³Ù…:</b> <span id="c-name"></span><br>
            <b>Ø§Ù„Ù€ ID:</b> <span id="c-id"></span><br>
            <b>Ø§Ù„ØµÙØ©:</b> <span id="c-role"></span><br>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=40x40&data=IPS" style="margin-top:10px; width:40px;">
        </div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://ips-khaldon-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let imgData = "";

    function upImg(i) {
        const r = new FileReader();
        r.onload = e => { imgData = e.target.result; document.getElementById('img-p').src = imgData; document.getElementById('img-p').style.display = 'block'; };
        r.readAsDataURL(i.files[0]);
    }

    function view(v) {
        document.getElementById('login-view').style.display = v==='login'?'block':'none';
        document.getElementById('reg-view').style.display = v==='reg'?'block':'none';
    }

    function doSave() {
        const id = document.getElementById('r-id').value;
        const name = document.getElementById('r-name').value;
        const pass = document.getElementById('r-pass').value;
        const btn = document.getElementById('save-btn');

        if(!id || !pass) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙˆØ±ÙŠ...";

        const role = id.startsWith("04") ? "Ù…Ø´Ø±Ù Ø¥Ø¯Ø§Ø±ÙŠ" : (id <= 202610 ? "Ø·Ø§Ù„Ø¨ - ØªØ§Ø³Ø¹" : "Ø·Ø§Ù„Ø¨ - Ø«Ø§Ù†ÙˆÙŠ");
        const data = { name, id, pass, photo: imgData, role, type: id.startsWith("04")?'admin':'student' };

        // Ø­ÙØ¸ Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù…Ø­Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙÙˆØ±ÙŠ [cite: 2026-01-28]
        localStorage.setItem('user_' + id, JSON.stringify(data));

        db.ref('users/' + id).set(data).then(() => {
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");
            location.reload();
        }).catch(() => {
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ (Ø¶Ø¹Ù Ø¥Ù†ØªØ±Ù†Øª). ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†.");
            location.reload();
        });
    }

    function doLogin() {
        const id = document.getElementById('l-id').value;
        const ps = document.getElementById('l-pass').value;

        // ÙØ­Øµ Ù…Ø­Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ø³Ø±Ø¹Ø©
        const local = localStorage.getItem('user_' + id);
        if(local) {
            const u = JSON.parse(local);
            if(u.pass === ps) return start(u);
        }

        db.ref('users/' + id).once('value').then(s => {
            const u = s.val();
            if(u && u.pass === ps) start(u); else alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©");
        });
    }

    function start(u) {
        document.getElementById('login-view').style.display = 'none';
        document.getElementById('profile-view').style.display = 'block';
        document.getElementById('u-name').innerText = u.name;
        document.getElementById('u-img').src = u.photo;
        document.getElementById('u-role').innerText = u.role;
        document.getElementById('c-name').innerText = u.name;
        document.getElementById('c-id').innerText = u.id;
        document.getElementById('c-role').innerText = u.role;
        document.getElementById('c-img').src = u.photo;

        if(u.type === 'admin') {
            document.getElementById('admin-list').style.display = 'block';
            db.ref('users').on('value', snap => {
                let h = "<b>Ø§Ù„Ø·Ù„Ø§Ø¨:</b><br>";
                for(let k in snap.val()) if(snap.val()[k].type === 'student') h += `â€¢ ${snap.val()[k].name}<br>`;
                document.getElementById('admin-list').innerHTML = h;
            });
        }
    }
</script>
</body>
</html>
