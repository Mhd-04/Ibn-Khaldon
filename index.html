<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… IPS - Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ø¨Ù† Ø®Ù„Ø¯ÙˆÙ†</title>
    <style>
        :root { --primary: #8e44ad; --bg: #f4f7fe; --sidebar-w: 260px; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; }
        .auth-screen { position: fixed; inset: 0; background: white; z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        .auth-card { width: 100%; max-width: 400px; text-align: center; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        input, select { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 14px; width: 100%; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .app-container { display: none; min-height: 100vh; }
        .sidebar { width: var(--sidebar-w); background: white; border-left: 1px solid #eee; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .main-content { flex-grow: 1; padding: 20px; }
        .card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; font-size: 14px; }
        .status-on { color: #27ae60; font-weight: bold; }
        @media (max-width: 768px) { .app-container { flex-direction: column; } .sidebar { width: 100%; border-left: 0; border-bottom: 1px solid #eee; } }
    </style>
</head>
<body>

<div id="auth-screen" class="auth-screen">
    <div id="login-box" class="auth-card">
        <img src="1000219663.jpg" style="width:120px; margin-bottom:10px;" onerror="this.src='https://cdn-icons-png.flaticon.com/512/5351/5351042.png'">
        <h2 style="color:var(--primary); margin:0;">IPS</h2>
        <input type="text" id="user-in" placeholder="ID Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¬Ù‡">
        <input type="password" id="pass-in" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-main" onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
        <p style="cursor:pointer; color:var(--primary); font-size:13px; margin-top:15px;" onclick="toggleAuth(true)">Ø£Ù„Ø§ ØªÙ…Ù„Ùƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</p>
    </div>

    <div id="register-box" class="auth-card" style="display:none;">
        <h3 style="color:var(--primary)">ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <input type="text" id="reg-name" placeholder="Ø§Ù„Ø§Ø³Ù…">
            <input type="text" id="reg-id" placeholder="ID">
            <input type="text" id="reg-father" placeholder="Ø§Ù„Ø£Ø¨">
            <input type="text" id="reg-mother" placeholder="Ø§Ù„Ø£Ù…">
            <input type="date" id="reg-dob">
            <input type="text" id="reg-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
            <input type="tel" id="reg-fPhone" placeholder="Ù‡Ø§ØªÙ Ø§Ù„Ø£Ø¨">
            <input type="tel" id="reg-mPhone" placeholder="Ù‡Ø§ØªÙ Ø§Ù„Ø£Ù…">
            <select id="reg-grade"><option>ØªØ§Ø³Ø¹</option><option>Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§</option></select>
            <input type="text" id="reg-section" placeholder="Ø§Ù„Ø´Ø¹Ø¨Ø©">
        </div>
        <input type="password" id="reg-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-main" onclick="handleRegister()">Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <p onclick="toggleAuth(false)" style="cursor:pointer; color:#666; font-size:12px; margin-top:10px;">Ø±Ø¬ÙˆØ¹</p>
    </div>
</div>

<div id="main-app" class="app-container">
    <div class="sidebar">
        <img src="1000219663.jpg" style="width:70px; margin-bottom:10px;" onerror="this.src='https://cdn-icons-png.flaticon.com/512/5351/5351042.png'">
        <h3 id="side-name">---</h3>
        <p id="side-id" style="color:#888; font-size:12px;">ID: ---</p>
        <div style="width:100%; margin-top:20px;">
            <div id="profile-tab-btn" style="padding:12px; background:#f0edff; color:var(--primary); border-radius:10px; cursor:pointer;" onclick="showTab('profile')">ğŸ‘¤ Ù…Ù„ÙØ§ØªÙŠ</div>
            <div id="admin-only-btn" style="display:none; padding:12px; color:#f39c12; cursor:pointer; font-weight:bold;" onclick="showTab('admin')">ğŸ›  Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆØ¬Ù‡</div>
        </div>
        <button onclick="location.reload()" style="margin-top:auto; width:100%; padding:10px; background:#ff7675; color:white; border:none; border-radius:10px; cursor:pointer;">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="main-content">
        <div id="tab-profile" class="card">
            <h3>ğŸ“‡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ (Ù…Ù„ÙØ§ØªÙŠ)</h3>
            <div id="profile-info" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
            <hr>
            <h3>ğŸ“Š Ø¹Ù„Ø§Ù…Ø§ØªÙŠ</h3>
            <table id="student-grades-table">
                <thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ù…Ø°Ø§ÙƒØ±Ø©</th><th>Ø§Ù…ØªØ­Ø§Ù†</th></tr></thead>
                <tbody id="st-grades-body"></tbody>
            </table>
        </div>

        <div id="tab-admin" class="card" style="display:none; border:2px solid #f39c12;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>ğŸ›  Ø±ØµØ¯ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª</h3>
                <button class="btn-main" style="width:auto; background:#27ae60;" onclick="publishGrades()">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            </div>
            <div class="card" style="background:#fffcf5;">
                <h4>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬Ù‡</h4>
                <input type="text" id="adm-name-edit" placeholder="Ø§Ø³Ù…Ùƒ">
                <input type="text" id="adm-role-edit" placeholder="Ø§Ù„Ù…Ù†ØµØ¨">
                <button class="btn-main" style="background:#f39c12; height:40px; padding:0;" onclick="saveAdminInfo()">Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</button>
            </div>
            <table>
                <thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>ID</th><th>Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</th><th>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                <tbody id="admin-list-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Ù‚Ø§Ø¦Ù…Ø© Ø·Ù„Ø§Ø¨ Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„ÙƒÙŠ Ù„Ø§ ÙŠØ¸Ù‡Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙØ§Ø±ØºØ§Ù‹ Ø£Ø¨Ø¯Ø§Ù‹
    const defaultStudents = [
        { name: "Ù…Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¹Ù„ÙŠ", id: "202311632", grade: "Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§", father: "Ø®Ø§Ù„Ø¯", mother: "Ù…Ø±ÙŠÙ…", dob: "2006-05-10", address: "Ø­Ù…Øµ", fPhone: "0933", mPhone: "0944", section: "1", pass: "123", quiz: 15, exam: 50 }
    ];

    let students = JSON.parse(localStorage.getItem('ips_db')) || defaultStudents;
    let adminInfo = JSON.parse(localStorage.getItem('ips_admin')) || { name: "Ù…Ø­Ù…Ø¯ ÙØ±Ø­Ø§Ù† Ø§Ù„ØºÙØ±ÙŠ", role: "Ù…ÙˆØ¬Ù‡" };
    let isPublished = localStorage.getItem('ips_published') === 'true';

    function toggleAuth(isReg) {
        document.getElementById('login-box').style.display = isReg ? 'none' : 'block';
        document.getElementById('register-box').style.display = isReg ? 'block' : 'none';
    }

    function handleRegister() {
        const s = {
            name: document.getElementById('reg-name').value, id: document.getElementById('reg-id').value,
            father: document.getElementById('reg-father').value, mother: document.getElementById('reg-mother').value,
            dob: document.getElementById('reg-dob').value, address: document.getElementById('reg-address').value,
            fPhone: document.getElementById('reg-fPhone').value, mPhone: document.getElementById('reg-mPhone').value,
            grade: document.getElementById('reg-grade').value, section: document.getElementById('reg-section').value,
            pass: document.getElementById('reg-pass').value, quiz: 0, exam: 0
        };
        if(!s.name || !s.id) return alert("Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù€ ID Ù…Ø·Ù„ÙˆØ¨Ø§Ù†");
        students.push(s);
        localStorage.setItem('ips_db', JSON.stringify(students));
        alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
        toggleAuth(false);
    }

    function handleLogin() {
        const u = document.getElementById('user-in').value;
        const p = document.getElementById('pass-in').value;
        if(u === "ibn khaldon" && p === "ITmohammedf0@") {
            loadApp(adminInfo.name, "ADMIN", true);
        } else {
            const st = students.find(s => s.id === u && s.pass === p);
            if(st) loadApp(st.name, st.id, false, st);
            else alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        }
    }

    function loadApp(name, id, isAdmin, stData = null) {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        document.getElementById('side-name').innerText = name;
        document.getElementById('side-id').innerText = "ID: " + id;
        if(isAdmin) {
            document.getElementById('admin-only-btn').style.display = 'block';
            renderAdminView();
            showTab('admin');
        } else {
            renderProfile(stData);
            showTab('profile');
        }
    }

    function renderAdminView() {
        const body = document.getElementById('admin-list-body');
        body.innerHTML = students.map((s, i) => `
            <tr>
                <td>${s.name}</td><td>${s.id}</td>
                <td><input type="number" value="${s.quiz}" onchange="updateScore(${i},'quiz',this.value)" style="width:45px"></td>
                <td><input type="number" value="${s.exam}" onchange="updateScore(${i},'exam',this.value)" style="width:45px"></td>
                <td><button onclick="deleteStudent(${i})" style="color:red; border:none; background:none; cursor:pointer;">Ø­Ø°Ù</button></td>
            </tr>`).join('');
    }

    function updateScore(idx, field, val) {
        students[idx][field] = parseInt(val) || 0;
        localStorage.setItem('ips_db', JSON.stringify(students));
    }

    function deleteStudent(idx) {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ")) {
            students.splice(idx, 1);
            localStorage.setItem('ips_db', JSON.stringify(students));
            renderAdminView();
        }
    }

    function publishGrades() {
        isPublished = true;
        localStorage.setItem('ips_published', 'true');
        alert("ğŸš€ ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨!");
    }

    function renderProfile(st) {
        const info = document.getElementById('profile-info');
        const fields = { father: "Ø§Ù„Ø£Ø¨", mother: "Ø§Ù„Ø£Ù…", dob: "Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯", address: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", fPhone: "Ù‡Ø§ØªÙ Ø§Ù„Ø£Ø¨", mPhone: "Ù‡Ø§ØªÙ Ø§Ù„Ø£Ù…", grade: "Ø§Ù„ØµÙ", section: "Ø§Ù„Ø´Ø¹Ø¨Ø©" };
        info.innerHTML = "";
        for(let k in fields) info.innerHTML += `<div style="background:#f8f9ff; padding:8px; border-radius:8px;"><small style="color:#888">${fields[k]}</small><br><b>${st[k] || '-'}</b></div>`;
        
        const gBody = document.getElementById('st-grades-body');
        if(!isPublished) {
            gBody.innerHTML = "<tr><td colspan='3'>Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø­Ø§Ù„ÙŠØ§Ù‹</td></tr>";
        } else {
            gBody.innerHTML = `<tr><td>Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</td><td>${st.quiz}</td><td>${st.exam}</td></tr>`;
        }
    }

    function showTab(t) {
        document.getElementById('tab-profile').style.display = t === 'profile' ? 'block' : 'none';
        document.getElementById('tab-admin').style.display = t === 'admin' ? 'block' : 'none';
    }

    function saveAdminInfo() {
        adminInfo.name = document.getElementById('adm-name-edit').value;
        adminInfo.role = document.getElementById('adm-role-edit').value;
        localStorage.setItem('ips_admin', JSON.stringify(adminInfo));
        document.getElementById('side-name').innerText = adminInfo.name;
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸");
    }
</script>
</body>
</html>
