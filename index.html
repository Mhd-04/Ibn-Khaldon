<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… IPS Ø§Ù„Ù…Ø·ÙˆØ± - Ø§Ø¨Ù† Ø®Ù„Ø¯ÙˆÙ†</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary: #8e44ad; --secondary: #2ecc71; --bg: #f4f7fe; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; overflow-x: hidden; }
        .card { background: white; border-radius: 15px; padding: 20px; margin: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input, select, button { width: 100%; padding: 12px; margin: 5px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; }
        .btn-main { background: var(--primary); color: white; border: none; cursor: pointer; font-weight: bold; }
        .profile-img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); }
        .ai-chat { background: #eef2ff; border-radius: 15px; padding: 15px; height: 200px; overflow-y: auto; border: 1px solid #d1d9ff; }
        .student-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-bottom: 1px solid #eee; }
        .badge { padding: 4px 8px; border-radius: 5px; color: white; font-size: 12px; }
        .bg-9 { background: #3498db; } .bg-10 { background: #2ecc71; } .bg-11 { background: #e67e22; }
        #main-app { display: none; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="card" id="login-box" style="max-width:400px; margin: 50px auto;">
        <img src="1000219663.jpg" style="width:100px;">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <input type="text" id="user-id" placeholder="ID Ø§Ù„Ø·Ø§Ù„Ø¨ Ø£Ùˆ Ø§Ù„Ù…ÙˆØ¬Ù‡">
        <input type="password" id="user-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-main" onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
        <p onclick="showReg(true)" style="cursor:pointer; color:var(--primary)">ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</p>
        <p onclick="showRegAdmin(true)" style="cursor:pointer; color:var(--secondary)">ØªØ³Ø¬ÙŠÙ„ Ù…ÙˆØ¬Ù‡/Ù…Ø´Ø±Ù</p>
    </div>

    <div class="card" id="reg-student" style="display:none; max-width:500px; margin: 20px auto;">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ - Ø£Ø¶Ù ØµÙˆØ±ØªÙƒ</h3>
        <input type="file" id="st-photo" accept="image/*" onchange="previewImg(this, 'st-preview')">
        <img id="st-preview" class="profile-img" src="">
        <div class="grid">
            <input type="text" id="st-name" placeholder="Ø§Ù„Ø§Ø³Ù…">
            <input type="number" id="st-id" placeholder="ID (202601-30)">
            <input type="text" id="st-father" placeholder="Ø§Ù„Ø£Ø¨">
            <input type="text" id="st-mother" placeholder="Ø§Ù„Ø£Ù…">
            <input type="tel" id="st-phone" placeholder="Ù‡Ø§ØªÙ Ø§Ù„Ø£Ø¨">
            <input type="password" id="st-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        </div>
        <button class="btn-main" onclick="saveStudent()">Ø­ÙØ¸ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <button onclick="showReg(false)">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div class="card" id="reg-admin" style="display:none; max-width:500px; margin: 20px auto;">
        <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬Ù‡ / Ø§Ù„Ù…Ø´Ø±Ù</h3>
        <div class="grid">
            <input type="text" id="ad-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="text" id="ad-role" placeholder="Ø§Ù„ØµÙØ© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©">
            <input type="date" id="ad-dob" title="Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯">
            <input type="tel" id="ad-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
            <input type="text" id="ad-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
            <input type="password" id="ad-pass" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±">
        </div>
        <button class="btn-main" style="background:#2ecc71" onclick="saveAdmin()">ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¬Ù‡</button>
        <button onclick="showRegAdmin(false)">Ø±Ø¬ÙˆØ¹</button>
    </div>
</div>

<div id="main-app">
    <div class="card">
        <div style="display:flex; align-items:center; gap:15px;">
            <img id="user-img" class="profile-img" src="">
            <div>
                <h3 id="display-name">---</h3>
                <p id="display-role">---</p>
            </div>
        </div>
    </div>

    <div class="card">
        <h4>ğŸ¤– Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ (AI)</h4>
        <div class="ai-chat" id="ai-res">Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ø§Ø¨Ù† Ø®Ù„Ø¯ÙˆÙ†ØŒ Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø´ÙŠØ¡ Ø¹Ù† Ø¯Ø±ÙˆØ³Ùƒ..</div>
        <input type="text" id="ai-msg" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..">
        <button class="btn-main" onclick="askAI()">Ø§Ø³Ø£Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</button>
    </div>

    <div id="student-section" class="card" style="display:none;">
        <h4>ğŸ“ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</h4>
        <div id="quiz-area">
            <p>Ø³Ø¤Ø§Ù„: Ù…Ø§ Ù‡Ùˆ Ø¹Ø§ØµÙ…Ø© Ø³ÙˆØ±ÙŠØ§ØŸ</p>
            <button onclick="alert('Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!')">Ø¯Ù…Ø´Ù‚</button>
            <button onclick="alert('Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©')">Ø­Ù„Ø¨</button>
        </div>
    </div>

    <div id="admin-section" class="card" style="display:none;">
        <h4>ğŸ“š Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…ØµÙ†ÙØ©</h4>
        <div id="students-list">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨...</div>
    </div>
</div>

<script>
    const conf = { databaseURL: "https://ips-khaldon-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(conf);
    const db = firebase.database();

    let currentPhoto = "";

    function previewImg(input, id) {
        const reader = new FileReader();
        reader.onload = e => { currentPhoto = e.target.result; document.getElementById(id).src = currentPhoto; };
        reader.readAsDataURL(input.files[0]);
    }

    function showReg(s) { document.getElementById('login-box').style.display = s?'none':'block'; document.getElementById('reg-student').style.display = s?'block':'none'; }
    function showRegAdmin(s) { document.getElementById('login-box').style.display = s?'none':'block'; document.getElementById('reg-admin').style.display = s?'block':'none'; }

    function saveStudent() {
        const id = document.getElementById('st-id').value;
        const data = {
            name: document.getElementById('st-name').value,
            id: id, photo: currentPhoto,
            grade: (id<=202610)?"ØªØ§Ø³Ø¹":(id<=202620)?"Ø¹Ø§Ø´Ø±":"Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±",
            gradeClass: (id<=202610)?"bg-9":(id<=202620)?"bg-10":"bg-11",
            pass: document.getElementById('st-pass').value, type: 'student'
        };
        db.ref('users/' + id).set(data).then(() => { alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„!"); location.reload(); });
    }

    function saveAdmin() {
        const name = document.getElementById('ad-name').value;
        const data = {
            name: name, role: document.getElementById('ad-role').value,
            dob: document.getElementById('ad-dob').value, phone: document.getElementById('ad-phone').value,
            address: document.getElementById('ad-address').value, pass: document.getElementById('ad-pass').value,
            type: 'admin', photo: 'https://cdn-icons-png.flaticon.com/512/9131/9131529.png'
        };
        db.ref('users/admin').set(data).then(() => { alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¬Ù‡!"); location.reload(); });
    }

    function handleLogin() {
        const id = document.getElementById('user-id').value;
        const ps = document.getElementById('user-pass').value;

        db.ref('users/' + id).once('value').then(snap => {
            const u = snap.val();
            if(u && u.pass === ps) launchApp(u);
            else if(id === 'ibn khaldon' && ps === 'ITmohammedf0@') {
                db.ref('users/admin').once('value').then(s => launchApp(s.val()));
            } else alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©");
        });
    }

    function launchApp(u) {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        document.getElementById('display-name').innerText = u.name;
        document.getElementById('display-role').innerText = u.role || u.grade;
        document.getElementById('user-img').src = u.photo || '';

        if(u.type === 'admin') {
            document.getElementById('admin-section').style.display = 'block';
            loadStudents();
        } else {
            document.getElementById('student-section').style.display = 'block';
        }
    }

    function loadStudents() {
        db.ref('users').on('value', snap => {
            const users = snap.val();
            let html = "";
            for(let id in users) {
                if(users[id].type === 'student') {
                    html += `<div class="student-item">
                        <img src="${users[id].photo}" style="width:40px;height:40px;border-radius:50%">
                        <div><b>${users[id].name}</b><br><small>ID: ${id}</small></div>
                        <span class="badge ${users[id].gradeClass}">${users[id].grade}</span>
                    </div>`;
                }
            }
            document.getElementById('students-list').innerHTML = html;
        });
    }

    async function askAI() {
        const msg = document.getElementById('ai-msg').value;
        const resBox = document.getElementById('ai-res');
        resBox.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...";
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø³ÙŠØ·Ø© (ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù€ API Ù„Ø§Ø­Ù‚Ø§Ù‹)
        setTimeout(() => {
            resBox.innerHTML = "Ø±Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ: Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ÙÙ‡Ù… " + msg + " Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„.";
        }, 1000);
    }
</script>
</body>
</html>
